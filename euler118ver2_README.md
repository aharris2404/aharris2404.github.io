#Euler Problem \#118 Solution

##Problem

[Project Euler Problem \#118](https://projecteuler.net/problem=118) asks one to determine the total number of unique freely partitioned/permuted sets that can be generated from the digits $\{1, 2, 3, 4, 5, 6, 7, 8, 9\}$ that contain only prime numbers. One example of such a freely partitioned/permuted set containing only prime numbers would be $\{2, 5, 47, 89, 631\}$.

##Solution

*For ease of explanation, we use a generalizable solution for a smaller case, the digits $\{1, 2, 3, 4\}$.*

###Brief Overview

First, calculate and store the total number of primes which can be generated by choosing digits from $\{1, 2, 3, 4\}$. Then, calculate the total number of ways of partitioning $\{1, 2, 3, 4\}$. For each way of partitioning, look up the total number of primes as stored in step 1, and thereby count the total number of freely partitioned/permuted sets that only contain prime numbers.

###Somewhat-Less-Brief Overview

The solution will work in the following steps:

1. Recursively generate combinations to count all possible ways of choosing digits from $\{1, 2, 3, 4\}$. One such choice would be $\{3, 4\}$.
2. Recursively generate permutations to count all possible ways of internally rearranging the combinations found in step 1. For example, $\{3, 4\}$ can be permuted as either $34$ or $43$.
3. Use naive trial division to calculate which of the permutations from step 2 are prime. For example, $34$ is not prime, but $43$ is.
4. Store the results from steps 1-3 in a dictionary-like object whose are keys all the combinations from step 1. Each combination-key's paired value is the number of prime permutations for that combination-key. So, this dictionary would contain the following key-value pair: $34:1$.
5. Recursively list [the possible ways of partitioning](https://oeis.org/A000041) a set containing 4 objects. One such partition would be $[3, 1]$.
6. For a particular partition, use recursion to count the different ways of slotting digits (partition choices) into each slice of the partition. For $[3, 1]$, $\{123, 4\}$ and $\{124, 3\}$ would be two such partition choices.
7. For each element within a partition choice, look up the corresponding value in the dictionary from step 4. Multiply these values together to determine the number of exclusively-prime freely-permuted sets that each partition choice produces.
8. Iterate through the possible partitions of $\{1, 2, 3, 4\}$, repeating steps 6 and 7 for each, and sum the results.

###Solution Advantages

* Adheres to black-box paradigm
* Generalizable for different-size inputs
* Saves time by not separately calculating possibilities such as $\{1, 2, 34\}$ and $\{1, 2, 43\}$ but just keeps tracking of how many permutations of $\{3, 4\}$ are prime. (Note that for the larger input $\{1, 2, 3, 4, 5, 6, 7, 8, 9\}$ there are many possible partition choices which contain $34$).
* Only runs trial division once per-permutation, instead of multiple times for every free concatenation that contains an identical element

###Solution Disadvantages

* Over 100 lines of code
* Uses primarily brute force leading to poor runtime scalability (although is acceptable speed for the given inputs)
* Computes possible combinations multiple times throughout algorithm
* Uses naive trial division instead of faster prime-checking algorithm

###Time Complexity

Let $n$ be the number of input digits. To generate the dictionary-object (by far the most computationally expensive part of the algorithm), we iterate the following for $k$, $1 \leq k \leq n$:

1. Calculate the number of permutations which can be made with $k$ elements from $n$, having $O({n \choose k})$ complexity.
2. Calculate trial division on each permutation. Since a permutation $p$ with $k$ digits must have that $p \leq 10^{k}$, trial division runs in $O(\sqrt{n})$ time, and $k \leq n$, trial division of each permutation has worst-case runtime $O(\sqrt{10^{n}}) = O(10^{\frac{n}{2}})$.

This results in a runtime which is expressed with the following series:

$$O(\sum_{k=1}^{n} \frac{n!}{(n-k)!})=O(n(10^\frac{n}{2})+n(n-1)(10^\frac{n}{2})+\cdots+n!(10^\frac{n}{2})$$

For which a simple worst-case upper bound is:

$$O(n\cdot n! \cdot 10^\frac{n}{2}) \leq O(n \cdot (n \sqrt10)^{n})$$
